<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail Help</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-gray-800 to-gray-900 text-gray-200 min-h-screen flex items-center justify-center">
    <div class="container max-w-3xl mx-auto p-6 bg-gray-800 rounded-lg shadow-2xl">
        <h2 class="text-3xl font-extrabold text-center mb-6 text-blue-400">Mail Manager</h2>
        
        <input type="text" id="search" placeholder="Search emails..." oninput="filterEmails()" 
            class="w-full p-3 rounded-md bg-gray-700 text-gray-100 border border-gray-600 focus:ring-2 focus:ring-blue-400 transition duration-200"/>
        
        <div class="flex justify-between my-5">
            <button onclick="filterByCategory('all')" class="px-5 py-2 bg-blue-500 rounded-md hover:bg-blue-600 transition duration-200">All</button>
            <button onclick="filterByCategory('Interested')" class="px-5 py-2 bg-green-500 rounded-md hover:bg-green-600 transition duration-200">Interested</button>
            <button onclick="filterByCategory('Not Interested')" class="px-5 py-2 bg-red-500 rounded-md hover:bg-red-600 transition duration-200">Not Interested</button>
        </div>

        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-blue-600 text-white">
                    <th class="p-3">Sender</th>
                    <th class="p-3">Subject</th>
                    <th class="p-3">Category</th>
                </tr>
            </thead>
            <tbody id="email-list" class="divide-y divide-gray-700">
            </tbody>
        </table>
    </div>
    
    <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden transition-opacity duration-300" id="emailPopup">
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-96 transform scale-90 opacity-0 transition-all duration-300" id="popupContent">
            <span class="float-right text-2xl cursor-pointer text-gray-400 hover:text-gray-200" onclick="closePopup()">&times;</span>
            <h3 id="popupSubject" class="text-lg font-semibold mb-3 text-blue-300"></h3>
            <p><strong>From:</strong> <span id="popupSender"></span></p>
            <p id="popupBody" class="mt-3 text-gray-300"></p>
            <textarea id="replyText" placeholder="Type your response..." 
                class="w-full p-3 mt-4 rounded-md bg-gray-700 text-gray-100 border border-gray-600"></textarea>
            <button class="w-full mt-3 p-3 bg-green-500 rounded-md hover:bg-green-600 transition duration-200" onclick="sendReply()">Send</button>
        </div>
    </div>
    
    <script>
        async function fetchEmails() {
            try {
                const response = await fetch("http://localhost:3000/emails");
                const data = await response.json();
                if (data.success) {
                    displayEmails(data.emails);
                }
            } catch (error) {
                console.error("Error retrieving emails:", error);
            }
        }

        function displayEmails(emails) {
            const emailList = document.getElementById("email-list");
            emailList.innerHTML = "";
            emails.reverse().forEach(email => {
                const row = document.createElement("tr");
                row.classList.add("hover:bg-gray-700", "cursor-pointer", "transition-all", "duration-200");
                row.innerHTML = `<td class='p-3'>${email.sender}</td>
                                 <td class='p-3'>${email.subject}</td>
                                 <td class='p-3'>${email.category || 'Unsorted'}</td>`;
                row.onclick = () => openPopup(email);
                emailList.appendChild(row);
            });
        }

        function openPopup(email) {
            document.getElementById("popupSubject").textContent = email.subject;
            document.getElementById("popupSender").textContent = email.sender;
            document.getElementById("popupBody").textContent = email.body;
            
            const popup = document.getElementById("emailPopup");
            const content = document.getElementById("popupContent");
            popup.classList.remove("hidden");
            setTimeout(() => {
                popup.classList.remove("opacity-0");
                content.classList.remove("scale-90", "opacity-0");
            }, 50);
        }

        function closePopup() {
            const popup = document.getElementById("emailPopup");
            const content = document.getElementById("popupContent");
            content.classList.add("scale-90", "opacity-0");
            setTimeout(() => popup.classList.add("hidden"), 300);
        }

        function sendReply() {
            const replyText = document.getElementById("replyText").value;
            alert("Response Sent: " + replyText);
        }

        function filterEmails() {
            const searchText = document.getElementById("search").value.toLowerCase();
            const rows = document.querySelectorAll("#email-list tr");
            rows.forEach(row => {
                const subject = row.children[1].textContent.toLowerCase();
                row.style.display = subject.includes(searchText) ? "" : "none";
            });
        }

        function filterByCategory(category) {
            const rows = document.querySelectorAll("#email-list tr");
            rows.forEach(row => {
                const emailCategory = row.children[2].textContent;
                row.style.display = category === 'all' || emailCategory === category ? "" : "none";
            });
        }

        fetchEmails();
    </script>
</body>
</html>
